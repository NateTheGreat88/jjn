<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JNJ Website</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="secret-pages.css">
    <link rel="stylesheet" href="animated-background.css">
    <script src="page-transitions.js" defer></script>
    <script src="secret-pages.js" defer></script>
    <script src="animated-background.js" defer></script>
    <!-- Firebase SDK for Authentication -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <link rel="stylesheet" href="auth.css">
    <script src="auth.js" defer></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading...</p>
    </div>
    
    <div class="container" id="mainContainer" style="opacity: 0; pointer-events: none;">
        <div class="top-controls">
            <div class="search-wrapper">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="Search pages..."
                    autocomplete="off"
                >
                <span class="search-icon">üîç</span>
            </div>
            <a href="profile.html" class="about-button" id="profileButton" style="margin-right: 10px;">üë§ Profile</a>
            <a href="about.html" class="about-button">About Us</a>
        </div>
        
        <header>
            <h1>JNJ Website</h1>
            <p class="subtitle">JNJ ‚Ä¢ Junhu Choi ‚Ä¢ Jaxon Croskey ‚Ä¢ Nathan DeLuca</p>
        </header>

        <section class="intro-section">
            <p class="intro-text">Welcome to our collaborative space! Explore our creative projects, tools, and creations.</p>
        </section>

        <section class="features-section">
            <div class="feature-item">
                <div class="feature-icon">üéµ</div>
                <h3>Music</h3>
                <p>Original compositions</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üíª</div>
                <h3>Tools</h3>
                <p>Interactive utilities</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üé®</div>
                <h3>Creative</h3>
                <p>Art & design tools</p>
            </div>
            <div class="feature-item">
                <div class="feature-icon">üí¨</div>
                <h3>Collaborate</h3>
                <p>Work together</p>
            </div>
        </section>
        
        <main>
            <div class="song-card" data-title="songs" data-description="music songs nathan jaxon junhu">
                <a href="songs.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üéµ</div>
                        <div class="song-info">
                            <h2>Songs</h2>
                            <p>Original compositions by JNJ</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div class="song-card" data-title="code editor" data-description="code programming editor interactive">
                <a href="codeeditor.html" class="song-link">
                    <div class="song-button">
                        <img src="codeicon.png" alt="Code Editor" class="song-image">
                        <div class="song-info">
                            <h2>Code Editor</h2>
                            <p>Interactive code editor</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div class="song-card" data-title="chat" data-description="collaborative messaging communication">
                <a href="chat.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #4a9eff 0%, #2563eb 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üí¨</div>
                        <div class="song-info">
                            <h2>Chat</h2>
                            <p>Collaborative messaging</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div class="song-card" data-title="image editor" data-description="image edit create art design">
                <a href="imageeditor.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üé®</div>
                        <div class="song-info">
                            <h2>Image Editor</h2>
                            <p>Edit and create images</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div id="asteroidsCard" class="song-card" data-title="asteroids game" data-description="game space asteroids play" style="display: none;">
                <a href="game.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üõ∏</div>
                        <div class="song-info">
                            <h2>Asteroids</h2>
                            <p>Space shooter game</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div id="minigamesCard" class="song-card" data-title="mini games" data-description="games collection snake tetris pong memory reaction" style="display: none;">
                <a href="minigames.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üéÆ</div>
                        <div class="song-info">
                            <h2>Mini Games</h2>
                            <p>Collection of classic games</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div class="song-card" data-title="scratch games" data-description="game scratch games collection">
                <a href="scratch-games.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üéÆ</div>
                        <div class="song-info">
                            <h2>Scratch Games</h2>
                            <p>Collection of Scratch games</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Recently visited">‚≠ê</span>
                </a>
            </div>
            <div id="secretsCard" class="song-card" data-title="secrets" data-description="hidden pages easter eggs unlock" style="display: none;">
                <a href="secrets.html" class="song-link">
                    <div class="song-button">
                        <div class="song-image" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üîê</div>
                        <div class="song-info">
                            <h2>Secrets</h2>
                            <p>Hidden pages and easter eggs</p>
                        </div>
                    </div>
                    <span class="recent-indicator" title="Discovered">üîì</span>
                </a>
            </div>
        </main>

        <footer class="footer">
            <p class="footer-text">Built with creativity and collaboration</p>
            <p class="footer-year">¬© 2025 JNJ <span class="secret-footer-hint" style="opacity: 0.01; font-size: 1px;">üîê</span></p>
            <a href="changelog.html" style="color: rgba(255, 255, 255, 0.6); text-decoration: none; font-size: 14px; margin-top: 10px; display: inline-block; transition: all 0.2s;" onmouseover="this.style.color='rgba(255, 255, 255, 0.9)'; this.style.textDecoration='underline';" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'; this.style.textDecoration='none';">üìã Changelog</a>
            <a href="secret-footer.html" class="secret-footer-link" title="Secret">üîê</a>
        </footer>
    </div>

    <script>
        // Search/Filter
        const searchInput = document.getElementById('searchInput');
        const songCards = document.querySelectorAll('.song-card');
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            songCards.forEach(card => {
                const title = card.dataset.title || '';
                const description = card.dataset.description || '';
                const text = `${title} ${description}`.toLowerCase();
                
                if (searchTerm === '' || text.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Update profile button with user avatar
        function updateProfileButton() {
            try {
                const profileData = localStorage.getItem('jnjUserProfile');
                const profileButton = document.getElementById('profileButton');
                if (profileButton && profileData) {
                    const profile = JSON.parse(profileData);
                    if (profile.avatarImage) {
                        profileButton.innerHTML = `<img src="${profile.avatarImage}" alt="Profile" style="width: 20px; height: 20px; border-radius: 50%; object-fit: cover; vertical-align: middle; margin-right: 6px; display: inline-block;"> Profile`;
                    } else if (profile.avatar) {
                        profileButton.innerHTML = `${profile.avatar} Profile`;
                    }
                }
            } catch (e) {
                console.error('Error updating profile button:', e);
            }
        }
        
        // Update profile button on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateProfileButton();
        });
        
        // Also update when returning to page (in case profile was updated)
        window.addEventListener('focus', () => {
            updateProfileButton();
        });
        
        // Recently Visited Tracking
        function trackPageVisit(page) {
            const recentPages = JSON.parse(localStorage.getItem('jjnRecentPages') || '[]');
            // Remove if already exists
            const index = recentPages.indexOf(page);
            if (index > -1) {
                recentPages.splice(index, 1);
            }
            // Add to front
            recentPages.unshift(page);
            // Keep only last 5
            if (recentPages.length > 5) {
                recentPages.pop();
            }
            localStorage.setItem('jjnRecentPages', JSON.stringify(recentPages));
        }
        
        function showRecentIndicators() {
            const recentPages = JSON.parse(localStorage.getItem('jjnRecentPages') || '[]');
            const pageMap = {
                'songs.html': 'songs',
                'codeeditor.html': 'code editor',
                'chat.html': 'chat',
                'imageeditor.html': 'image editor',
                'game.html': 'asteroids game',
                'minigames.html': 'mini games',
                'scratch-games.html': 'scratch games',
                'lost-scampton-fight.html': 'lost spamton fight',
                'dino-game.html': 'dino game',
                'profile.html': 'profile',
                'secrets.html': 'secrets',
                'changelog.html': 'changelog',
            };
            
            songCards.forEach(card => {
                const link = card.querySelector('a');
                const href = link.getAttribute('href');
                const pageName = pageMap[href] || href.replace('.html', '');
                
                const indicator = card.querySelector('.recent-indicator');
                if (recentPages.includes(href)) {
                    indicator.style.display = 'block';
                } else {
                    indicator.style.display = 'none';
                }
            });
        }
        
        // Track when user clicks a link
        document.querySelectorAll('.song-link').forEach(link => {
            link.addEventListener('click', () => {
                const href = link.getAttribute('href');
                trackPageVisit(href);
            });
        });
        
        // Show indicators on page load
        showRecentIndicators();
        
        // Show Secrets button if any secrets are unlocked
        function checkAndShowSecretsButton() {
            if (window.secretPages) {
                const secrets = window.secretPages.getAll();
                const hasUnlocked = Object.values(secrets).some(secret => secret.unlocked);
                if (hasUnlocked) {
                    const secretsCard = document.getElementById('secretsCard');
                    if (secretsCard) {
                        secretsCard.style.display = 'block';
                    }
                }
            } else {
                // Retry after a short delay if secretPages isn't loaded yet
                setTimeout(checkAndShowSecretsButton, 100);
            }
        }
        
        // Check if games are unlocked
        function checkGamesUnlocked() {
            const gamesUnlocked = localStorage.getItem('jnjGamesUnlocked') === 'true';
            if (gamesUnlocked) {
                const asteroidsCard = document.getElementById('asteroidsCard');
                const minigamesCard = document.getElementById('minigamesCard');
                if (asteroidsCard) asteroidsCard.style.display = 'block';
                if (minigamesCard) minigamesCard.style.display = 'block';
            }
        }
        
        // Check on page load
        checkAndShowSecretsButton();
        checkGamesUnlocked();
        
        // Also check when secretPages becomes available
        window.addEventListener('load', () => {
            checkAndShowSecretsButton();
            checkGamesUnlocked();
        });
        
        // Cursor Trail Effect - Smooth line effect
        const trails = [];
        const maxTrails = 50;
        let lastTime = 0;
        
        function createCursorTrail(x, y, delay = 0) {
            setTimeout(() => {
                // Create new trail element
                const trail = document.createElement('div');
                trail.className = 'cursor-trail';
                trail.style.left = x + 'px';
                trail.style.top = y + 'px';
                trail.style.opacity = '0.6';
                document.body.appendChild(trail);
                
                // Smooth fade out
                requestAnimationFrame(() => {
                    trail.style.opacity = '0';
                    trail.style.transform = 'translate(-50%, -50%) scale(0.2)';
                });
                
                // Remove after animation
                setTimeout(() => {
                    if (trail.parentNode) {
                        trail.remove();
                    }
                }, 800);
                
                // Store for cleanup
                trails.push(trail);
                if (trails.length > maxTrails) {
                    const oldTrail = trails.shift();
                    if (oldTrail && oldTrail.parentNode) {
                        oldTrail.remove();
                    }
                }
            }, delay);
        }
        
        // Track mouse movement with smooth interpolation
        let lastX = 0;
        let lastY = 0;
        let mouseX = 0;
        let mouseY = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            
            const now = Date.now();
            const timeSinceLastTrail = now - lastTime;
            
            // Create trail very frequently for continuous line effect
            if (timeSinceLastTrail > 8) { // ~120fps for smoother line
                const distance = Math.sqrt(
                    Math.pow(mouseX - lastX, 2) + Math.pow(mouseY - lastY, 2)
                );
                
                // Create dots closer together for continuous line
                if (distance > 2) {
                    createCursorTrail(mouseX, mouseY);
                    lastX = mouseX;
                    lastY = mouseY;
                    lastTime = now;
                }
            }
        });
        
        // Sparkle effect for song cards
        function createSparkle(element, x, y) {
            const sparkle = document.createElement('span');
            const sparkles = ['‚ú®', '‚≠ê'];
            sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
            sparkle.style.position = 'absolute';
            sparkle.style.left = x + 'px';
            sparkle.style.top = y + 'px';
            sparkle.style.fontSize = (8 + Math.random() * 6) + 'px';
            sparkle.style.pointerEvents = 'none';
            sparkle.style.zIndex = '1000';
            sparkle.style.opacity = '1';
            sparkle.style.userSelect = 'none';
            sparkle.style.transform = 'translate(-50%, -50%)';
            
            // Random direction
            const angle = Math.random() * Math.PI * 2;
            const distance = 40 + Math.random() * 30;
            const endX = Math.cos(angle) * distance;
            const endY = Math.sin(angle) * distance;
            const rotation = Math.random() * 360 - 180;
            
            element.appendChild(sparkle);
            
            // Animate
            sparkle.animate([
                {
                    transform: 'translate(-50%, -50%) scale(1) rotate(0deg)',
                    opacity: 1
                },
                {
                    transform: `translate(calc(-50% + ${endX}px), calc(-50% + ${endY}px)) scale(0.2) rotate(${rotation}deg)`,
                    opacity: 0
                }
            ], {
                duration: 600 + Math.random() * 300,
                easing: 'ease-out',
                fill: 'forwards'
            });
            
            // Remove after animation
            setTimeout(() => {
                if (sparkle.parentNode) {
                    sparkle.remove();
                }
            }, 1000);
        }
        
        // Add sparkle effect to all song cards
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.song-card').forEach(card => {
                let sparkleInterval;
                
                card.addEventListener('mouseenter', () => {
                    // Create sparkles continuously while hovering
                    sparkleInterval = setInterval(() => {
                        const cardRect = card.getBoundingClientRect();
                        const mouseX = window.mouseX || cardRect.left + cardRect.width / 2;
                        const mouseY = window.mouseY || cardRect.top + cardRect.height / 2;
                        
                        // Convert to relative position within card
                        const relativeX = mouseX - cardRect.left;
                        const relativeY = mouseY - cardRect.top;
                        
                        // Create a sparkle
                        createSparkle(card, relativeX, relativeY);
                    }, 150); // Create sparkle every 150ms while hovering
                });
                
                card.addEventListener('mouseleave', () => {
                    if (sparkleInterval) {
                        clearInterval(sparkleInterval);
                    }
                });
                
                card.addEventListener('mousemove', (e) => {
                    // Store mouse position for sparkle creation
                    window.mouseX = e.clientX;
                    window.mouseY = e.clientY;
                });
            });
        });
        
        // Authentication Modal
        function initAuthModal() {
            const authOverlay = document.createElement('div');
            authOverlay.className = 'auth-overlay';
            authOverlay.id = 'authOverlay';
            authOverlay.innerHTML = `
                <div class="auth-modal">
                    <h2>Welcome to JNJ Website</h2>
                    <p>Sign in to save your progress, secrets, and preferences</p>
                    
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="signin">Sign In</button>
                        <button class="auth-tab" data-tab="signup">Create Account</button>
                    </div>
                    
                    <div id="authError" class="auth-error"></div>
                    <div id="authSuccess" class="auth-success"></div>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <button id="googleSignInBtn" class="auth-google-btn">
                        <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px;">
                            <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                            <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                            <path fill="#FBBC05" d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.712 0-.595.102-1.172.282-1.712V4.956H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.044l3.007-2.332z"/>
                            <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.964 7.288C4.672 5.163 6.656 3.58 9 3.58z"/>
                        </svg>
                        Continue with Google
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <form id="signInForm" class="auth-form active">
                        <div class="auth-form-group">
                            <label for="signInEmail">Email</label>
                            <input type="email" id="signInEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="auth-form-group">
                            <label for="signInPassword">Password</label>
                            <input type="password" id="signInPassword" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="auth-submit-btn">Sign In</button>
                        <div id="signInLoading" class="auth-loading">Signing in...</div>
                    </form>
                    
                    <form id="signUpForm" class="auth-form">
                        <div class="auth-form-group">
                            <label for="signUpEmail">Email</label>
                            <input type="email" id="signUpEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="auth-form-group">
                            <label for="signUpPassword">Password</label>
                            <input type="password" id="signUpPassword" placeholder="Create a password" required minlength="6">
                        </div>
                        <div class="auth-form-group">
                            <label for="signUpPasswordConfirm">Confirm Password</label>
                            <input type="password" id="signUpPasswordConfirm" placeholder="Confirm your password" required minlength="6">
                        </div>
                        <button type="submit" class="auth-submit-btn">Create Account</button>
                        <div id="signUpLoading" class="auth-loading">Creating account...</div>
                    </form>
                </div>
            `;
            document.body.appendChild(authOverlay);
            
            // Tab switching
            const tabs = authOverlay.querySelectorAll('.auth-tab');
            const forms = authOverlay.querySelectorAll('.auth-form');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    forms.forEach(f => f.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tabName === 'signin' ? 'signInForm' : 'signUpForm').classList.add('active');
                    
                    // Clear errors
                    document.getElementById('authError').classList.remove('show');
                    document.getElementById('authSuccess').classList.remove('show');
                });
            });
            
            // Google sign-in button
            const googleSignInBtn = document.getElementById('googleSignInBtn');
            if (googleSignInBtn) {
                googleSignInBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const errorDiv = document.getElementById('authError');
                    const successDiv = document.getElementById('authSuccess');
                    
                    errorDiv.classList.remove('show');
                    successDiv.classList.remove('show');
                    
                    googleSignInBtn.disabled = true;
                    googleSignInBtn.style.opacity = '0.6';
                    googleSignInBtn.textContent = 'Signing in...';
                    
                    if (window.authSystem) {
                        const result = await window.authSystem.signInWithGoogle();
                        googleSignInBtn.disabled = false;
                        googleSignInBtn.style.opacity = '1';
                        googleSignInBtn.innerHTML = `
                            <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px;">
                                <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                                <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                                <path fill="#FBBC05" d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.712 0-.595.102-1.172.282-1.712V4.956H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.044l3.007-2.332z"/>
                                <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.964 7.288C4.672 5.163 6.656 3.58 9 3.58z"/>
                            </svg>
                            Continue with Google
                        `;
                        
                        if (result.success) {
                            successDiv.textContent = 'Signed in with Google successfully!';
                            successDiv.classList.add('show');
                            hideLoadingScreen();
                            setTimeout(() => {
                                authOverlay.style.display = 'none';
                                document.body.classList.add('authenticated');
                            }, 1000);
                        } else {
                            let errorMsg = result.error || 'Failed to sign in with Google. Please try again.';
                            errorDiv.textContent = errorMsg;
                            errorDiv.classList.add('show');
                        }
                    } else {
                        googleSignInBtn.disabled = false;
                        googleSignInBtn.style.opacity = '1';
                        errorDiv.textContent = 'Authentication system not loaded. Please refresh the page.';
                        errorDiv.classList.add('show');
                    }
                });
            }
            
            // Sign in form
            document.getElementById('signInForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signInEmail').value.trim();
                const password = document.getElementById('signInPassword').value;
                const errorDiv = document.getElementById('authError');
                const successDiv = document.getElementById('authSuccess');
                const loadingDiv = document.getElementById('signInLoading');
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                
                errorDiv.classList.remove('show');
                successDiv.classList.remove('show');
                loadingDiv.classList.add('show');
                submitBtn.disabled = true;
                
                if (window.authSystem) {
                    const result = await window.authSystem.signIn(email, password);
                    loadingDiv.classList.remove('show');
                    submitBtn.disabled = false;
                    
                    if (result.success) {
                        successDiv.textContent = 'Signed in successfully!';
                        successDiv.classList.add('show');
                        setTimeout(() => {
                            authOverlay.style.display = 'none';
                            document.body.classList.add('authenticated');
                        }, 1000);
                    } else {
                        let errorMsg = result.error || 'Failed to sign in. Please try again.';
                        if (errorMsg.includes('configuration-not-found')) {
                            errorMsg = 'Firebase Authentication is not enabled. Please enable Email/Password authentication in Firebase Console. See FIREBASE_AUTH_SETUP.md for instructions.';
                        }
                        errorDiv.textContent = errorMsg;
                        errorDiv.classList.add('show');
                    }
                } else {
                    loadingDiv.classList.remove('show');
                    submitBtn.disabled = false;
                    errorDiv.textContent = 'Authentication system not loaded. Please refresh the page.';
                    errorDiv.classList.add('show');
                }
            });
            
            // Sign up form
            document.getElementById('signUpForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signUpEmail').value.trim();
                const password = document.getElementById('signUpPassword').value;
                const passwordConfirm = document.getElementById('signUpPasswordConfirm').value;
                const errorDiv = document.getElementById('authError');
                const successDiv = document.getElementById('authSuccess');
                const loadingDiv = document.getElementById('signUpLoading');
                const submitBtn = e.target.querySelector('.auth-submit-btn');
                
                errorDiv.classList.remove('show');
                successDiv.classList.remove('show');
                
                // Validate passwords match
                if (password !== passwordConfirm) {
                    errorDiv.textContent = 'Passwords do not match!';
                    errorDiv.classList.add('show');
                    return;
                }
                
                if (password.length < 6) {
                    errorDiv.textContent = 'Password must be at least 6 characters long!';
                    errorDiv.classList.add('show');
                    return;
                }
                
                loadingDiv.classList.add('show');
                submitBtn.disabled = true;
                
                if (window.authSystem) {
                    const result = await window.authSystem.signUp(email, password);
                    loadingDiv.classList.remove('show');
                    submitBtn.disabled = false;
                    
                    if (result.success) {
                        successDiv.textContent = 'Account created successfully!';
                        successDiv.classList.add('show');
                        hideLoadingScreen();
                        setTimeout(() => {
                            authOverlay.style.display = 'none';
                            document.body.classList.add('authenticated');
                        }, 1000);
                    } else {
                        let errorMsg = result.error || 'Failed to create account. Please try again.';
                        if (errorMsg.includes('configuration-not-found')) {
                            errorMsg = 'Firebase Authentication is not enabled. Please enable Email/Password authentication in Firebase Console. See FIREBASE_AUTH_SETUP.md for instructions.';
                        }
                        errorDiv.textContent = errorMsg;
                        errorDiv.classList.add('show');
                    }
                } else {
                    loadingDiv.classList.remove('show');
                    submitBtn.disabled = false;
                    errorDiv.textContent = 'Authentication system not loaded. Please refresh the page.';
                    errorDiv.classList.add('show');
                }
            });
            
            // Hide loading screen and show content
            function hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                const mainContainer = document.getElementById('mainContainer');
                
                if (loadingScreen) {
                    loadingScreen.classList.add('hidden');
                    // Remove from DOM after animation
                    setTimeout(() => {
                        loadingScreen.remove();
                    }, 300);
                }
                
                // Show main content
                if (mainContainer) {
                    mainContainer.style.opacity = '1';
                    mainContainer.style.pointerEvents = 'auto';
                }
            }
            
            // Check auth state and show/hide modal
            function checkAuthState() {
                if (window.authSystem && window.authSystem.isAuthenticated()) {
                    // User is authenticated - hide overlay, show content
                    authOverlay.style.display = 'none';
                    document.body.classList.add('authenticated');
                    hideLoadingScreen();
                } else {
                    // User is not authenticated
                    if (window.authSystem) {
                        // Auth system loaded, show sign-in modal
                        hideLoadingScreen();
                        // Small delay to ensure loading screen is gone before showing modal
                        setTimeout(() => {
                            authOverlay.style.display = 'flex';
                        }, 100);
                    } else {
                        // Wait a bit more for auth system to load
                        setTimeout(checkAuthState, 500);
                    }
                }
            }
            
            // Listen for auth state changes
            window.addEventListener('authStateChanged', (e) => {
                checkAuthState();
            });
            
            // Initial check - wait a bit longer to ensure auth.js is loaded
            setTimeout(checkAuthState, 1000);
        }
        
        // Initialize auth modal when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAuthModal);
        } else {
            initAuthModal();
        }
    </script>
</body>
</html>
